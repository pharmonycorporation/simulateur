{% load static %}

<!DOCTYPE html>
<!--
* CoreUI - Free Bootstrap Admin Template
* @version v3.2.0
* @link https://coreui.io
* Copyright (c) 2020 creativeLabs Łukasz Holeczek
* Licensed under MIT (https://coreui.io/license)
-->

<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.23/b-1.6.5/b-colvis-1.6.5/b-html5-1.6.5/r-2.2.7/datatables.min.css"/>
 
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

<style>
.cemaclogo{
  width:30px;
  height:20px;
}
.cemacdiv {
  float:right;
  position:fixed;
  top:2px;
  right:1rem;
}
.loader{
	background: url('static/assets/img/simulateur.gif') 50% 50% no-repeat rgba(255, 255, 255, 0.8);
	cursor: wait;
	height: 100%;
	left: 0;
	position: fixed;
	top: 0;
	width: 100%;
	z-index: 9999;
}
.loader h1{
		background: none;
		border: none;
		color: 	#002669;
		font-size: 22px;
		font-family: "Open Sans",sans-serif;
		font-variant: small-caps;
		font-weight: 700;
		height: 700px;
		line-height: 700px;
		margin: 140px 0 0;
		padding: 0;
		text-align: center;
	}
.slow-transition {
  box-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.3);
  transition: box-shadow 500ms;
}

.slow-transition:hover {
  box-shadow: 0 10px 50px 0 rgba(0, 0, 0, 0.5);
}

/* The fast, new way! */
.fast-transition {
  position: relative; /* For positioning the pseudo-element */
  box-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.3);
}

.fast-transition::before {
  /* Position the pseudo-element. */
  content: ' ';
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;

  /* Create the box shadow at expanded size. */
  box-shadow: 0 10px 50px 0 rgba(204,169,44, 0.5);

  /* Hidden by default. */
  opacity: 0;
  transition: opacity 500ms;
}

.fast-transition:hover::before {
  /* Show the pseudo-element on hover. */
  opacity: 1;
}

#sim {
    -webkit-transition: width 2s ease;
    -moz-transition: width 2s ease;
    -o-transition: width 2s ease;
    transition: width 2s ease;
    
    display: inline-block;
    overflow: hidden;
    white-space: nowrap;
    background: #D20F36;
    vertical-align: middle;
    width: 0px;
    box-shadow:0 0 0 rgba(204,169,44, 0.4);
}
#sim.in {
    width: 100%;
    border:0px;
    
}

.pulse {
  position:fixed;
  bottom:-20px;
  left:-20px;
  display: block;
  width: 80px;
  height: 80px;
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 0 0 rgba(204,169,44, 0.4);
  animation: pulse 2s infinite;
  z-index:99999;
  border:0px;
  text-decoration :none;
  color:#ffffff; 
  background:#002669
}
.pulse:hover {
  animation: none;
  border:0px;
}

@-webkit-keyframes pulse {
  0% {
    -webkit-box-shadow: 0 0 0 0 rgba(204,169,44, 0.4);
  }
  70% {
      -webkit-box-shadow: 0 0 0 10px rgba(204,169,44, 0);
  }
  100% {
      -webkit-box-shadow: 0 0 0 0 rgba(204,169,44, 0);
  }
}
@keyframes pulse {
  0% {
    -moz-box-shadow: 0 0 0 0 rgba(204,169,44, 0.4);
    box-shadow: 0 0 0 0 rgba(204,169,44, 0.4);
  }
  70% {
      -moz-box-shadow: 0 0 0 10px rgba(204,169,44, 0);
      box-shadow: 0 0 0 10px rgba(204,169,44, 0);
  }
  100% {
      -moz-box-shadow: 0 0 0 0 rgba(204,169,44, 0);
      box-shadow: 0 0 0 0 rgba(204,169,44, 0);
  }
}ont: inherit;
}
</style>

<head>

  <body class="c-app">
  <script>
  
   /* jQuery( window ).load( function(){
    $("#exampleModal").modal().show();
    //$( "body" ).trigger( "click" );
    });
      */
  </script>
    <div class="c-wrapper c-fixed-components">
      <header class="c-header c-header-light c-header-fixed c-header-with-subheader">
        
       
        <div class="c-subheader px-3">
          <!-- Breadcrumb-->
          <ol class="breadcrumb border-0 m-0">
            <li class="breadcrumb-item"><a href="/"> Retour à l'Accueil<a/></li>
            <li class="breadcrumb-item"> / Simulateur des droits et taxes douanières <img src="{% static 'assets/img/cemac/cemac.png'%}" width="30px" height="30px" /></li>
            
            <!-- Breadcrumb Menu-->
          </ol>
          <div class="cemacdiv">
            <img src="{% static 'assets/img/cemac/cmr.png'%}" class="cemaclogo" />
            <img src="{% static 'assets/img/cemac/congo.png'%}" class="cemaclogo"/>
            <img src="{% static 'assets/img/cemac/gabon.png'%}" class="cemaclogo"/>
            <img src="{% static 'assets/img/cemac/guinee.png'%}" class="cemaclogo"/>
            <img src="{% static 'assets/img/cemac/rca.png'%}" class="cemaclogo" />
            <img src="{% static 'assets/img/cemac/tchad.png'%}" class="cemaclogo"/>
            </div>
        </div>
      </header>
      <br>
      <br>
      <div class="c-body">
        <main class="c-main">
          <div class="container-fluid">
            <div class="fade-in">
              <div class="row">
                <div class="col-sm-12">
                  <div class="card">
                    <div class="card-header"><strong>TEC + </strong> <small> TVA + DACC + TS </small></div>
                      <div class="card-body">
                        <div class="row">
                          <div class="col-sm-12">
                          <div id="wait" class="loader" ><br><h1>Demarrage du Simulateur...</h1></div>
                            
                            
                            <table id="example" class="table table-responsive-sm table-striped table-bordered" >
                                <thead>
                                    <tr>
                                        <th>Nomenclature</th>
                                        <th>Libellé</th>
                                        <th>Quotite</th>
                                        <th>Unité statistique</th>
                                        <th>Exhonération TVA</th>
                                        <th>DACC</th>
                                        <th>T.S</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="testBody">
                                      {% for tarif in tarifs %}
                                    <tr id="{{tarif.id}}">
                                        <td>{{tarif.nomenclature}}
                                            </td>
                                        <td>{{tarif.libelleNomenclature}}</td>
                                        <td>{{tarif.quotite}}
                                        </td>
                                        <td> {{tarif.uniteStatistique}}</td>
                                        <td> {{tarif.exhonereTVA}}</td>
                                        <td> {{tarif.dacc}}</td>
                                        <td> {{tarif.ts}}</td>
                                        <td><button id="{{tarif.id}}" class="btn btn-success btn-sm" onclick="javascript:ajouterLigneSimulateur(this); return false;" >Ajouter</button></td>
                                    
                                    </tr>
                                {%endfor%}
                                
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <th>Nomenclature</th>
                                        <th>Libellé</th>
                                        <th>Quotite</th>
                                        <th>Unité statistique</th>
                                        <th>Exhonération TVA</th>
                                        <th>DACC</th>
                                        <th>T.S</th>
                                        <th>Action</th>
                                    </tr>
                                </tfoot>
                            </table>
                          </div>
                        </div>
                      
                      </div>
                    </div>
                </div>
                <!-- /.col-->
               
                <!-- /.col-->
              </div>
              <!-- /.row-->
            
              <!-- /.row-->
              <br>
               <button type="button"  class="pulse" data-toggle="toggle" data-target="#sim">
                      <i class="glyphicon glyphicon-plus"></i>SIM
                  </button>
              <div class="row" id="sim"  style="position:fixed;bottom:0px">
                <div class="col-sm-12">
                  <div class="card fast-transition">
                    <div class="card-header"><strong>SIMULATEUR</strong>
                   
                    
                     </div>
                    <div class="card-body">

                        <div id="tabSimulateur">   
            <table style="display:none;"  id="logo">
            <tr>
             <td colspan="2">SIMULATEUR DES TAXES D'IMPORTATIONS DOUANIERES / HORS CEMAC</td>
            </tr>
            <tr>
            <td width="20%"><img src="{% static 'images_cgi/LOGOCGI_r.png' %}"  alt width="150" height="150"></td>
           
            <td width="80%">
                <table width="100%" id="infoEntreprise">

                </table>
                <!--
                <input type="text" id="entreprise" style="border:0px;width:100%"/><br>
                <input type="text" id="adresse" style="border:0px;width:100%;"/>-->
            </td>
            </tr>
            </table>
            <table class="table table-responsive-sm" >
                <thead class="thead-dark">
                    <tr>
                        <th scope="col">Nomenclature</th>
                        <th scope="col">Quotite</th>
                        
                        <th scope="col">Valeur Imposable</th>
                        <th scope="col">DD</th>
                        <th scope="col">TVA</th>
                        <th scope="col">D ACC</th>
                        <th scope="col">ACPTE</th>
                        <th scope="col">RST</th>
                        <th scope="col">TCI</th>
                        <th scope="col"> CCI</th>
                        <th scope="col"> TUA</th>
                        <th scope="col"> TS</th>

                    </tr>
                </thead>
                <tbody id="simulateur">
                    
                    
                </tbody>
            </table>
            </div>
           
            <button type="button"  class="btn btn-primary" style="float:right" onclick="javascript:ajoutIdentite(this); return false;">
                 GENERER LA FACTURE
            </button>
                      
                    </div>
                  </div>
                </div>
                <!-- /.col-->
               
                <!-- /.col-->
              </div>
              <!-- /.row-->

            </div>
          </div>
        </main>
        
      </div>
    </div>
    <!-- CoreUI and necessary plugins-->
 
    <!--<![endif]-->
 

<div class="modal fade" id="entreeModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog  modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Informations sur l'importateur</h5>
       
      </div>
      <div class="modal-body">
          <div class="row">
                <div class="col-sm-6">  
                     <div class="card">
                        <div class="card-body">
                              <div class="form-group">
                                <label for="inputEmail3">Importateur</label>
                                <input class="form-control" id="importateurId" type="text" placeholder="Raison sociale">
                              </div>
                              <div class="form-group">
                                <label for="inputEmail01" >Régime Fiscale </label>
                                <input type="email" class="form-control" id="regimeId" placeholder="Régime Fiscale">
                              </div>
                              <div class="form-group">
                                <label for="country">Vers quel pays souhaitez-vous importer ?</label><select class="form-control" id="destinationId">
                                {% for countrie in cemacs %}
                                    <option value="{{countrie.nom}}">{{countrie.nom}}</option>
                                {% endfor %}
                                </select> 
                              </div>
                              <div class="form-group">
                                <label for="country">Pays de provenance</label><select class="form-control" id="provenanceId">
                                {% for country in pays %}
                                    <option value="{{country.nom}}">{{country.nom}}</option>
                                {% endfor %}
                                </select> 
                              </div>
                        </div>
                      </div>      
                </div>
                <div class="col-sm-6">
                  <div class="card">
                    <div class="card-body">
                            <div class="form-group ">
                                <label for="inputEmail02" >Nomenclature tarifaire </label>
                                <input type="email" class="form-control" id="nomenclatureId" placeholder="Nomenclature tarifaire">    
                            </div>
                            <div class="form-group ">
                                <label for="inputEmail003" >Moyen de transport </label>
                                <select class="form-control" id="transportId">
                                {% for trans in transports %}
                                    <option value="{{trans.moyen}}">{{trans.moyen}}</option>
                                {% endfor %}
                                </select> 
                              
                            </div>
                            <div class="form-group ">
                                <label for="inputEmail03" >Mode de paiement </label>
                                 <select class="form-control" id="paiementId">
                                {% for mode in paiements %}
                                    <option value="{{mode.mode}}">{{mode.mode}}</option>
                                {% endfor %}
                                </select>    
                            </div>
                            <div class="form-group ">
                                <label for="deviseId" >Devise </label>
                                <select class="form-control" id="deviseId">
                                {% for dev in devises %}
                                    <option value="{{dev.nomDevise}}">{{dev.nomDevise}}-{{dev.codeDevise}}</option>
                                {% endfor %}
                                </select> 
                                  
                            </div>
                    </div>
                  </div>
                </div> 
          </div>
      </div>
          <div class="modal-footer">
            
            <button type="button" class="btn btn-primary" id="memoriser" onclick="javascript:debuterSimulation(this); return false;">Enregistrer et Démarrer le simulateur</button>
          </div>
        </div>
        </div>
      </div>
              
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Veuillez remplir ce formulaire</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
      <div class="container">
      <div class="row">
   
       
        </div class="col-sm-10">
            <div class="card">
                   
                <div class="card-body">
          
                    <div class="form-group">
                        <label for="valeurFacture" >Valeur Facture</label>
                        <input type="text" class="form-control" id="valeurFacture" placeholder="Valeur Facture">
                    </div>
                    <div class="form-group">
                        <label for="fret" >Fret</label>
                        <input type="text" class="form-control" id="fret" placeholder="Fret">
                    </div>
                    <div class="form-group">
                        <label for="assurance" >Assurance</label>
                        <input type="text" class="form-control" id="assurance" placeholder="Assurance">
                    </div>
                    <div class="form-group">
                        <label for="idtotal" >Total</label>
                        <input type="text" class="form-control" id="idtotal" placeholder="total">
                    </div>
                    <div class="form-group row">
                        <label for="valImposable" >Valeur Imposable</label>
                        <input type="text" class="form-control" id="valImposable" placeholder="Valeur Imposable">
                    </div>
                    <div class="form-group ">
                        <label for="fretNational" >Fret national</label>
                        <input type="text" class="form-control" id="fretNational" placeholder="Fret national">
                    </div>
                    <div class="form-group row">
                        <label for="ValeurStatistique" >Valeur statistique</label>
                        <input type="text" class="form-control" id="ValeurStatistique" placeholder="ValeurStatistique">
                    </div>
        
        </div>
        
      </div>
      
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
        <button type="button" class="btn btn-primary" id="facture" onclick="javascript:genereFacture(this); return false;">Enregistrer</button>
      </div>
    </div>
  </div>
</div>
    <script src="https://code.jquery.com/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.23/b-1.6.5/b-colvis-1.6.5/b-html5-1.6.5/r-2.2.7/datatables.min.js"></script>
     <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  
    <script src="https://kendo.cdn.telerik.com/2017.2.621/js/jszip.min.js"></script>
    <script src="https://kendo.cdn.telerik.com/2017.2.621/js/kendo.all.min.js"></script>
    
    <script>
        jQuery(window).load(function(){ jQuery(".loader").fadeOut("200"); });
    </script>
    <script type="text/javascript">

    var debuterSimulation = function(link){

         let nomenclature = $("#nomenclatureId").val();
         let regime = $("#regimeId").val();
         let provenance = $("#provenanceId").val();
         let destination = $("#destinationId").val();
         let importateur = $("#importateurId").val();
         let devise = $("#deviseId").val();
         let paiement = $("#paiementId").val();
         let transport = $("#transportId").val();

         if(importateur != ""){
            $.ajax({
                url: "{% url 'demarrerSimulateur' %}",
                method:"POST",
                data: {
                  'regime':regime,
                  'nomenclature':nomenclature,
                  'provenance':provenance,
                  'destination':destination,
                  'importateur':importateur,
                  'devise':devise,
                  'paiement':paiement,
                  'transport':transport,
                  'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
                dataType: 'json',
                success: function (data) {

                  if(data['success']){
                    $("#entreeModal").modal('hide');
                    alert("enregistrement effectué, debut de la simulation");
                  }else{
                    alert("une erreur s'est produite lors de l'enregistrement des données");
                  }

                }                
                 });
        
         }else{
           alert("Veuillez renseigner le champs importateur");
         }
          
           
      }



    $("[data-toggle='toggle']").click(function() {
    var selector = $(this).data("target");
    $(selector).toggleClass('in');
});
$('#example').DataTable( { 
                        responsive:'true'
                      });
    $(window).on('load',function(){
     //$("#wait").css("display", "block");
      $("#entreeModal").modal({
        backdrop:'static',
        keyboard:false,
        show:true
      });
      
        var te = 1
        /*
           $.ajax({
                url: "{% url 'gettarifs' %}",
                data: {
                  'te':te,
                },
                dataType: 'json',
                success: function (data) {
                  
                  //alert("test");
                   tbody = document.getElementById("testBody");
                     
                  for(let i=0; i<data.length; i++){
                      tr = document.createElement('tr');
                      tr.setAttribute("id",data[i].id);
                      tdnom = document.createElement('td');
                      tdnom.innerHTML = data[i].nomenclature;
                      tr.appendChild(tdnom);
                      tdLibelle = document.createElement('td');
                      tdLibelle.innerHTML = data[i].libelleNomenclature;
                      tr.appendChild(tdLibelle);
                      tdquotite = document.createElement('td');
                      tdquotite.innerHTML = data[i].quotite;
                      tr.appendChild(tdquotite);
                      tduniteStatistique = document.createElement('td');
                      tduniteStatistique.innerHTML = data[i].uniteStatistique;
                      tr.appendChild(tduniteStatistique);
                      tdtva= document.createElement('td');
                      tdtva.innerHTML = data[i].tva;
                      tr.appendChild(tdtva);
                      tddacc= document.createElement('td');
                      tddacc.innerHTML = data[i].dacc;
                      tr.appendChild(tddacc);
                      tdts= document.createElement('td');
                      tdts.innerHTML = data[i].ts;
                      tr.appendChild(tdts);
                      tdbutton= document.createElement('td');
                      button = document.createElement('button');
                      button.setAttribute("id",data[i].id);
                      button.setAttribute("class","btn btn-success btn-sm");
                      button.setAttribute("onclick","javascript:ajouterLigneSimulateur(this); return false;");
                      button.innerHTML = "Ajouter"
                      tdbutton.appendChild(button);
                      tr.appendChild(tdbutton);

                      tbody.appendChild(tr); 
                   }
                     

                   //$("#wait").css("display", "none");
                   
                }});*/

                  /*
                                    {% for tarif in tarifs %}
                                    <tr id="{{tarif.id}}">
                                        <td>{{tarif.nomenclature}}
                                            </td>
                                        <td>{{tarif.libelleNomenclature}}</td>
                                        <td>{{tarif.quotite}}
                                        </td>
                                        <td> {{tarif.uniteStatistique}}</td>
                                        <td> {{tarif.exhonereTVA}}</td>
                                        <td> {{tarif.dacc}}</td>
                                        <td> {{tarif.ts}}</td>
                                        <td><button id="{{tarif.id}}" onclick="javascript:ajouterLigneSimulateur(this); return false;" >Ajouter</button></td>
                                    
                                    </tr>
                                {%endfor%}*/
                  //  $('#myModal').modal('show');<br>
    });
 
</script>
    <script>

        var nbclick  = 0;
        var tabId = [];

              
     
        var ajoutIdentite =  function(link){
            if(nbclick >= 1){
                    $("#exampleModal").modal().show();
            }else{
                alert("veuillez ajouter un élément au panier");
            }
             
        }

        
        var genereFacture = function (link){
            if ($("#inputEmail3").val() != "" && $("#inputPassword3").val() != "")
            {
                let bloc =  document.getElementById("infoEntreprise");
                tr1 = document.createElement('tr');
                td1=document.createElement('td');
                td1.innerHTML = "Importateur : " + $("#inputEmail3").val();
                td2=document.createElement('td');
                td2.innerHTML = "Regime Fiscal:" + $("#inputEmail01").val();
                tr1.appendChild(td1);
                tr1.appendChild(td2);
                bloc.appendChild(tr1);

                tr2 = document.createElement('tr');
                td11=document.createElement('td');
                td11.innerHTML=" Nomenclature Tarifaire :"+ $("#inputEmail02").val();
                td22=document.createElement('td');
                td22.innerHTML =" Moyen de transport :"+ $("#inputEmail003").val();
                tr2.appendChild(td11);
                tr2.appendChild(td22);
                bloc.appendChild(tr2);

                tr3 = document.createElement('tr');
                td13 =document.createElement('td');
                td13.innerHTML = " Mode de paiement :"+$("#inputEmail03").val();
                td23 =document.createElement('td');
                td23.innerHTML = " Email :" + $("#inputPassword3").val();
                tr3.appendChild(td13);
                tr3.appendChild(td23);
                bloc.appendChild(tr3)

                 // entre = document.getElementById("entreprise").setAttribute("value",$("#inputEmail3").val())
                // adresse = document.getElementById("adresse").setAttribute("value",$("#inputPassword3").val())
                tableau = document.getElementById("logo");
                tableau.setAttribute("style","display:show");

                $("#exampleModal").modal('hide');
                        let mesTaxes =[] ;
                        let mesTva =0 ;
                        let mesRST =0;
                        let mesCCI =0;
                        let mesTCI =0;
                        let mesTUA =0;
                        let acc =0;
                        let acptes =0;
                        let somme = 0;
                        let tabTVA = [];
                        for (let i = 0 ; i<tabId.length; i++){
                            mesTaxes[i] = parseFloat(document.getElementById("taxes-"+tabId[i]).value);
                            somme += mesTaxes[i];
                            mesTva += parseFloat(document.getElementById("Tva-"+tabId[i]).value);
                            somme += parseFloat(document.getElementById("Tva-"+tabId[i]).value);
                            mesRST += parseFloat(document.getElementById("Rst-"+tabId[i]).value);
                            somme += parseFloat(document.getElementById("Rst-"+tabId[i]).value);
                            mesCCI += parseFloat(document.getElementById("Cci-"+tabId[i]).value);
                            somme += parseFloat(document.getElementById("Cci-"+tabId[i]).value);
                            mesTCI +=parseFloat(document.getElementById("Tci-"+tabId[i]).value);
                            somme += parseFloat(document.getElementById("Tci-"+tabId[i]).value);
                            mesTUA += parseFloat(document.getElementById("Tua-"+tabId[i]).value);
                            somme += parseFloat(document.getElementById("Tua-"+tabId[i]).value);
                            acptes += parseFloat(document.getElementById("Acpte-"+tabId[i]).value);
                            somme += parseFloat(document.getElementById("Acpte-"+tabId[i]).value);
                            acc += parseFloat(document.getElementById("Dacc-"+tabId[i]).value);
                            somme += parseFloat(document.getElementById("Dacc-"+tabId[i]).value);
                            //console.log("valeur : "+i, somme);

                        }
                        let total = parseFloat(somme);

                        body = document.getElementById("simulateur");
                            tr1 = document.createElement('tr');
                            tr1.setAttribute("id","totalTVA");
                            tdcol1 = document.createElement('td');
                            tdcol1.setAttribute("colspan","4");
                            tdcol1.innerHTML = "TOTAL TVA";

                            tr1.appendChild(tdcol1);
                            tdcol2 = document.createElement('td');
                            tdcol2.setAttribute("colspan","8");
                            tdcol2.innerHTML = mesTva;
                            tr1.appendChild(tdcol2);

                            tr3 = document.createElement('tr');
                            tr3.setAttribute("id","totaldacc");
                            tdcol3 = document.createElement('td');
                            tdcol3.setAttribute("colspan","5");
                            tdcol3.innerHTML = "TOTAL DACC";

                            tr3.appendChild(tdcol3);
                            tdcol23 = document.createElement('td');
                            tdcol23.setAttribute("colspan","7");
                            tdcol23.innerHTML = acc;
                            tr3.appendChild(tdcol23);

                            tr = document.createElement('tr');
                            tr.setAttribute("id","total");
                            tdcol11 = document.createElement('td');
                            tdcol11.setAttribute("colspan","11");
                            tdcol11.innerHTML = "TOTAL";

                            tr.appendChild(tdcol11);
                            tdcol22 = document.createElement('td');
                            tdcol22.innerHTML = "<b style='font-size:20px'>"+total+"</b>";
                            tr.appendChild(tdcol22);

                        body.appendChild(tr1);
                        body.appendChild(tr3);
                        body.appendChild(tr);

                        kendo.drawing
                            .drawDOM("#tabSimulateur", 
                            { 
                                paperSize: "A4",
                                orientation:"horizontal",landscape: true,
                                margin: { top: "1cm", left:"0.2cm", right:"0.2cm", bottom: "1cm" },
                                scale: 0.8,
                                height: 500
                            })
                            .then(function(group){
                            kendo.drawing.pdf.saveAs(group, "simulateur.pdf")
                            });

            }else{
                alert("veuillez remplir tous les champs");
            }
           
            //alert(somme);
        }
        var calculeTaxe = function (link){
            var row = link.parentNode.parentNode;
			var table = row.parentNode;
			var id = row.getAttribute('id');
            var donnee = id.split("-");
            let pa = document.getElementById("pa-"+donnee[1]).value 
            let quotite = document.getElementById("quotite-"+donnee[1]).value 
            //let quantite = document.getElementById("quantite-"+donnee[1]).value 
            let taxesInput = document.getElementById("taxes-"+donnee[1]);
            let tvaInput = document.getElementById("Tva-"+donnee[1]);
            let daccInput = document.getElementById("Dacc-"+donnee[1]);
            let Tciinput = document.getElementById("Tci-"+donnee[1]);
            let Tuainput = document.getElementById("Tua-"+donnee[1]);
            let CCIinput = document.getElementById("Cci-"+donnee[1]);
            let RSTinput = document.getElementById("Rst-"+donnee[1]);
            let Acpteinput = document.getElementById("Acpte-"+donnee[1]);  
            //alert(Acpteinput.getAttribute("id"));     
            let tsInput = document.getElementById("Ts-"+donnee[1]);
            let tsInputValue = tsInput.value
            
            let A = parseInt(pa);
            let B = parseInt(A*quotite)/100;
            //tva
            let valeurTVA =  parseFloat(document.getElementById("paysTva").value);
            //alert(valeurTVA);
            let assujetieTVA =  parseInt(document.getElementById("Tva2-"+donnee[1]).value);
            let daccQuotite =  parseInt(document.getElementById("Dacc2-"+donnee[1]).value);
            //alert(assujetieTVA);

            let C= parseFloat(assujetieTVA*(A+B)*valeurTVA/100);
            let D = parseFloat((A+C)*daccQuotite/100);
            let AC4 = parseFloat(((A+B)*4)/100);
            let RST =parseFloat(A*2/100) ;
            let TCI = parseFloat(A/100) ; 
            let CCI = parseFloat(A*0.4/100) ;
            let TUA = parseFloat(A*0.2/100);
            let TS = parseFloat(A*parseInt(tsInputValue));
            //alert(AC4);
            Acpteinput.setAttribute("value",AC4);
            tvaInput.setAttribute("value",C);
            daccInput.setAttribute("value",D);
            taxesInput.setAttribute("value",B);
            Tciinput.setAttribute("value",TCI);
            Tuainput.setAttribute("value",TUA);
            CCIinput.setAttribute("value",CCI);
            RSTinput.setAttribute("value",RST);
            tsInput.setAttribute("value",TS);
            
        }

        var ajouterLigneSimulateur = function (link) {
            var row = link.parentNode.parentNode;
            var table = row.parentNode;
            tarifId = row.getAttribute("id");
            $("#exampleModal").modal().show();
        
            $.ajax({
                url: "{% url 'ajax_gettarif' %}",
                data: {
                'id': tarifId
                },
                dataType: 'json',
                success: function (data) {
                   
                   body = document.getElementById("simulateur");
                   tr = document.createElement('tr');
                   tr.setAttribute("id","simulateur-"+tarifId);
                   tdNomenclature = document.createElement('td');
                   tdNomenclature.innerHTML= data.tarif.nomenclature
                   tr.appendChild(tdNomenclature);
                    /*
                   tdLibelle = document.createElement('td');
                   tdLibelle.innerHTML = data.tarif.libelleNomenclature;
                   tr.appendChild(tdLibelle);*/

                   tdQuotite = document.createElement('td');
                   inputQuotite = document.createElement('input');
                   inputQuotite.setAttribute('id',"quotite-"+tarifId);
                   inputQuotite.setAttribute('type',"text");
                   inputQuotite.setAttribute('style',"border:0px");
                     
                   inputQuotite.setAttribute('disabled',"disabled");
                   inputQuotite.setAttribute('class',"form-control");
                   inputQuotite.setAttribute('value',data.tarif.quotite);
                   tdQuotite.appendChild(inputQuotite);
                   tr.appendChild(tdQuotite);
                    
                 

                   tdPA = document.createElement('td');
                   inputPA = document.createElement('input');
                   inputPA.setAttribute("type","text");
                   inputPA.setAttribute("value","");
                   inputPA.setAttribute("style","border:0px");
                   inputPA.setAttribute('class',"form-control");
                   inputPA.setAttribute("id","pa-"+tarifId);
                   inputPA.setAttribute("onBlur","javascript:calculeTaxe(this);return false;")
                   tdPA.appendChild(inputPA);
                   tr.appendChild(tdPA);
                   
                 

                   tdTaxes = document.createElement('td');
                   inputTaxes = document.createElement('input');
                   inputTaxes.setAttribute("id","taxes-"+tarifId);
                   inputTaxes.setAttribute("type","text");
                   inputTaxes.setAttribute("style","border:0px;");
                   inputTaxes.setAttribute('disabled',"disabled"); 
                   inputTaxes.setAttribute('class',"form-control"); 
                   tdTaxes.appendChild(inputTaxes);
                   tr.appendChild(tdTaxes);

                   tdTva = document.createElement('td');
                   inputTva  = document.createElement('input');
                   inputTva.setAttribute('id',"Tva-"+tarifId);
                   inputTva.setAttribute('type',"text");  
                   inputTva.setAttribute('style',"border:0px;");  
                   inputTva.setAttribute('disabled',"disabled");  
                   inputTva.setAttribute('class',"form-control");  
                   inputTva2  = document.createElement('input');
                   inputTva2.setAttribute('id',"Tva2-"+tarifId);
                   inputTva2.setAttribute('type',"text");  
                   inputTva2.setAttribute('style',"border:0px;");  
                   inputTva2.setAttribute('value',data.tarif.tva);  
                   inputTva2.setAttribute('hidden',"hidden");  
                   tdTva.appendChild(inputTva);
                   tdTva.appendChild(inputTva2);
                   tr.appendChild(tdTva);

                   tdDacc = document.createElement('td');
                   inputDacc  = document.createElement('input');
                   inputDacc.setAttribute('id',"Dacc-"+tarifId);
                   inputDacc.setAttribute('type',"text");  
                   inputDacc.setAttribute('style',"border:0px;");  
                   inputDacc.setAttribute('disabled',"disabled");  
                   inputDacc2  = document.createElement('input');
                   inputDacc2.setAttribute('id',"Dacc2-"+tarifId);
                   inputDacc2.setAttribute('type',"text");  
                   inputDacc2.setAttribute('style',"border:0px;");  
                   inputDacc2.setAttribute('value',data.tarif.dacc);  
                   inputDacc2.setAttribute('hidden',"hidden");  
                   tdDacc.appendChild(inputDacc);
                   tdDacc.appendChild(inputDacc2);
                   tr.appendChild(tdDacc);

                   tdAcpte = document.createElement('td');
                   inputAcpte = document.createElement('input');
                   inputAcpte.setAttribute('id',"Acpte-"+tarifId);
                   inputAcpte.setAttribute('type',"text");  
                   inputAcpte.setAttribute('style',"border:0px;");  
                   inputAcpte.setAttribute('disabled',"disabled");  
                   inputAcpte.setAttribute('class',"form-control"); 
                   tdAcpte.appendChild(inputAcpte);
                   tr.appendChild(tdAcpte);

                   tdRst = document.createElement('td');
                   inputRst  = document.createElement('input');
                   inputRst.setAttribute('id',"Rst-"+tarifId);
                   inputRst.setAttribute('type',"text");  
                   inputRst.setAttribute('style',"border:0px;");  
                   inputRst.setAttribute('disabled',"disabled");  
                   inputRst.setAttribute('class',"form-control"); 
                   tdRst.appendChild(inputRst);
                   tr.appendChild(tdRst);

                   tdTci = document.createElement('td');
                   inputTci  = document.createElement('input');
                   inputTci.setAttribute('id',"Tci-"+tarifId);
                   inputTci.setAttribute('type',"text");  
                   inputTci.setAttribute('style',"border:0px;");  
                   inputTci.setAttribute('disabled',"disabled");  
                   inputTci.setAttribute('class',"form-control"); 
                   tdTci.appendChild(inputTci);
                   tr.appendChild(tdTci);

                   tdCci = document.createElement('td');
                   inputCci  = document.createElement('input');
                   inputCci.setAttribute('id',"Cci-"+tarifId);
                   inputCci.setAttribute('type',"text");  
                   inputCci.setAttribute('style',"border:0px;");  
                   inputCci.setAttribute('disabled',"disabled");  
                   inputCci.setAttribute('class',"form-control");  
                   tdCci.appendChild(inputCci);
                   tr.appendChild(tdCci);

                   tdTua = document.createElement('td');
                   inputTua  = document.createElement('input');
                   inputTua.setAttribute('id',"Tua-"+tarifId);
                   inputTua.setAttribute('type',"text");  
                   inputTua.setAttribute('style',"border:0px;");  
                   inputTua.setAttribute('disabled',"disabled");  
                   inputTua.setAttribute('class',"form-control"); 
                   tdTua.appendChild(inputTua);
                   tr.appendChild(tdTua);

                   tdTs = document.createElement('td');
                   inputTs  = document.createElement('input');
                   inputTs.setAttribute('id',"Ts-"+tarifId);
                   inputTs.setAttribute('type',"text");  
                   inputTs.setAttribute('style',"border:0px;");  
                   inputTs.setAttribute('value',data.tarif.ts);  
                   inputTs.setAttribute('disabled',"disabled");  
                   inputTs.setAttribute('class',"form-control");  
                   tdTs.appendChild(inputTs);
                   tr.appendChild(tdTs);

                   body.appendChild(tr);
                   tabId[nbclick]=tarifId;
                   nbclick++;

                }
            });
        
}

 </script>

</body>
</html>
